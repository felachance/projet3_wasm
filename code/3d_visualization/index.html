<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>OBJ Viewer</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
}
#picker {
    position: absolute;
    z-index: 10;
    left: 10px;
    top: 10px;
}
canvas {
    display: block;
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
}
</style>
</head>
<body>
<input type="file" id="picker" accept=".obj">
<div style="width:100vw; height:100vh; display:flex; align-items:center; justify-content:center;">
<canvas id="canvas" width="800" height="600"></canvas>
</div>
<script type="module">
    import Module from "./index.js";

    console.log("Loading WASM...");
    const wasm = await Module();  // the Module is fully initialized now
    console.log("WASM loaded");
    try {
    wasm._main();
    } catch (e) {
        if (e !== "unwind") throw e;
    }
    console.log("WASM main executed");
    

    document.getElementById("picker").addEventListener("change", async (ev) => {
        console.log("File selected");
        const file = ev.target.files[0];
        if (!file) return;

        const text = await file.text();
        const u8 = new TextEncoder().encode(text);

        const ptr = wasm._malloc(u8.length);
        wasm.HEAPU8.set(u8, ptr);
        wasm._LoadOBJFromMemory(ptr, u8.length);
        wasm._free(ptr);
    });
</script>
</body>
</html>
